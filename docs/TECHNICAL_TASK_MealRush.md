# Техническое задание: MealRush

## 1. Резюме проекта

**Версия:** 2.0.0  
**Дата создания:** 20 октября 2024  
**Статус:** Утверждено

### 1.1. Краткое описание

MealRush — мобильное приложение для отслеживания питания и подсчета калорий с акцентом на удобство использования и точность данных. Приложение позволяет пользователям вести дневник питания, сканировать штрихкоды продуктов, анализировать блюда по фотографии, отслеживать достижение целей по весу и получать персонализированные рекомендации по калорийности рациона.

### 1.2. Ключевые стейкхолдеры

| Роль                                         | Ответственность                                         | Контакт |
| -------------------------------------------- | ------------------------------------------------------- | ------- |
| Product Owner / Заказчик                     | Определение требований, приоритизация функций           | L423r   |
| Технический лид / Backend Developer / DevOps | Архитектура, разработка серверной части, инфраструктура | L423r   |
| Frontend Developer                           | Разработка мобильного приложения                        | Knois   |
| QA / Тестировщик                             | Тестирование, выявление багов                           | ir1sha  |

---

## 2. Бизнес-требования

### 2.1. Проблема

Существующие приложения для отслеживания питания имеют следующие недостатки:

- Неполная база продуктов для рынка СНГ
- Сложность ввода данных о приемах пищи
- Недостаточная точность данных по штрихкодам
- Отсутствие быстрого способа анализа состава блюд
- Перегруженный интерфейс с излишними функциями

MealRush решает эти проблемы за счет:

- Интеграции с качественными базами данных продуктов
- Возможности сканирования штрихкодов
- Анализа блюд по фотографии с помощью AI
- Простого и интуитивного интерфейса
- Быстрого добавления продуктов и блюд

### 2.2. Цели проекта

- **Цель 1:** Достичь 1,000 активных пользователей в первые 3 месяца после запуска
- **Цель 2:** Обеспечить удержание пользователей на уровне 40%+ через месяц использования
- **Цель 3:** Масштабировать систему до 100,000 пользователей в течение года
- **Цель 4:** Создать монетизируемый продукт (реклама или подписка)

### 2.3. Целевая аудитория

**Основные пользователи:**

- Люди, следящие за своим питанием (возраст 15-60 лет): стремление к здоровому образу жизни, контроль калорийности рациона, отслеживание КБЖУ
- География: страны СНГ (Россия, Казахстан, Беларусь, Украина)
- Уровень технической грамотности: средний и высокий (пользователи смартфонов)

**Вторичные пользователи:**

- Спортсмены и фитнес-энтузиасты: точный контроль макронутриентов
- Люди с медицинскими показаниями: диабет, ожирение, пищевые аллергии

### 2.4. Ключевые метрики успеха

| Метрика                                                      | Текущее значение | Целевое значение | Срок      |
| ------------------------------------------------------------ | ---------------- | ---------------- | --------- |
| Количество активных пользователей                            | 0                | 1,000            | 3 месяца  |
| Retention (30 дней)                                          | N/A              | 40%              | 6 месяцев |
| Количество добавленных приемов пищи в день (на пользователя) | N/A              | 3+               | 3 месяца  |
| Время на добавление приема пищи                              | N/A              | < 30 сек         | MVP       |
| Точность данных по штрихкодам                                | N/A              | > 85%            | MVP       |

---

## 3. Функциональные требования

### 3.1. Основные функции

**Модуль 1: Аутентификация и профиль пользователя**

```
Функция 1.1: Регистрация пользователя
- Описание: Регистрация нового пользователя с созданием профиля
- Пользовательский сценарий:
  1. Пользователь вводит email и пароль
  2. Пользователь указывает пол, дату рождения, вес, рост
  3. Пользователь выбирает цель (набрать/сбросить/сохранить вес)
  4. Пользователь указывает желаемый вес (если актуально)
  5. Пользователь выбирает уровень физической активности
  6. Система рассчитывает рекомендуемую калорийность
  7. Профиль создан, пользователь авторизован
- Входные данные: email, пароль, имя, пол, дата рождения, текущий вес, рост, целевой вес, уровень активности
- Выходные данные: JWT токен, профиль пользователя
- Ограничения: пароль минимум 8 символов, корректный email

Функция 1.2: Вход в систему
- Описание: Аутентификация существующего пользователя
- Пользовательский сценарий: Пользователь вводит email и пароль → получает доступ
- Входные данные: email, пароль
- Выходные данные: JWT токен
- Ограничения: валидация учетных данных

Функция 1.3: Интеграция с Google Sign-In
- Описание: Авторизация через Google аккаунт
- Пользовательский сценарий: Пользователь нажимает "Войти через Google" → авторизуется через Google → получает доступ
- Входные данные: Google OAuth токен
- Выходные данные: JWT токен, профиль пользователя
- Ограничения: требуется Google аккаунт

Функция 1.4: Восстановление пароля
- Описание: Сброс пароля через email
- Пользовательский сценарий: Пользователь вводит email → получает новый пароль на почту
- Входные данные: email
- Выходные данные: новый пароль на email
- Ограничения: email должен быть зарегистрирован

Функция 1.5: Редактирование профиля
- Описание: Изменение параметров профиля (вес, рост, цель, активность)
- Пользовательский сценарий: Пользователь изменяет параметры → система пересчитывает рекомендации
- Входные данные: обновленные параметры профиля
- Выходные данные: обновленный профиль, новая рекомендуемая калорийность
- Ограничения: валидация вводимых данных

Функция 1.6: Просмотр профиля
- Описание: Отображение данных профиля и статистики
- Пользовательский сценарий: Пользователь открывает раздел "Профиль" → видит свои данные, ИМТ, рекомендации
- Входные данные: нет
- Выходные данные: данные профиля, ИМТ, рекомендуемая калорийность, суточная норма
- Ограничения: нет
```

**Модуль 2: Управление приемами пищи**

```
Функция 2.1: Создание приема пищи
- Описание: Добавление нового приема пищи (завтрак, обед, ужин, перекус)
- Пользовательский сценарий:
  1. Пользователь выбирает дату
  2. Пользователь выбирает тип приема пищи и время
  3. Пользователь добавляет продукты/блюда
  4. Прием пищи сохранен
- Входные данные: дата, время, тип приема пищи, список продуктов/блюд
- Выходные данные: созданный прием пищи с подсчитанными КБЖУ
- Ограничения: хотя бы один продукт/блюдо

Функция 2.2: Просмотр приемов пищи за день
- Описание: Отображение всех приемов пищи за выбранную дату
- Пользовательский сценарий: Пользователь выбирает дату → видит все приемы пищи и дневную статистику
- Входные данные: дата
- Выходные данные: список приемов пищи, суммарные КБЖУ за день
- Ограничения: нет

Функция 2.3: Редактирование приема пищи
- Описание: Изменение состава приема пищи
- Пользовательский сценарий: Пользователь открывает прием пищи → изменяет продукты/количество → сохраняет
- Входные данные: ID приема пищи, обновленные данные
- Выходные данные: обновленный прием пищи с пересчитанными КБЖУ
- Ограничения: нельзя редактировать чужие приемы пищи

Функция 2.4: Удаление приема пищи
- Описание: Удаление приема пищи
- Пользовательский сценарий: Пользователь открывает прием пищи → удаляет → подтверждает
- Входные данные: ID приема пищи
- Выходные данные: статус удаления
- Ограничения: нельзя удалять чужие приемы пищи

Функция 2.5: Выбор даты для просмотра
- Описание: Календарь для выбора даты
- Пользовательский сценарий: Пользователь нажимает на календарь → выбирает дату → видит приемы пищи за эту дату
- Входные данные: дата
- Выходные данные: приемы пищи за выбранную дату
- Ограничения: нельзя выбрать дату раньше 1950 года
```

**Модуль 3: Управление продуктами**

```
Функция 3.1: Поиск продуктов
- Описание: Поиск продуктов в общей и пользовательской базе
- Пользовательский сценарий: Пользователь вводит название продукта → видит список найденных продуктов
- Входные данные: строка поиска
- Выходные данные: список продуктов с КБЖУ
- Ограничения: минимум 2 символа для поиска

Функция 3.2: Сканирование штрихкода
- Описание: Распознавание продукта по штрихкоду с помощью камеры
- Пользовательский сценарий:
  1. Пользователь нажимает "Сканировать"
  2. Наводит камеру на штрихкод
  3. Система распознает код и находит продукт
  4. Если продукт найден → отображается информация
  5. Если не найден → предложение создать новый
- Входные данные: изображение штрихкода
- Выходные данные: данные о продукте или сообщение об отсутствии
- Ограничения: требуется доступ к камере

Функция 3.3: Создание пользовательского продукта
- Описание: Добавление нового продукта в личную базу
- Пользовательский сценарий:
  1. Пользователь вводит название, количество (на 100г)
  2. Вводит КБЖУ (белки, жиры, углеводы, калории)
  3. Выбирает категорию
  4. Опционально добавляет фото
  5. Сохраняет продукт
- Входные данные: название, КБЖУ, категория, фото (опционально)
- Выходные данные: созданный продукт
- Ограничения: количество должно быть указано

Функция 3.4: Редактирование пользовательского продукта
- Описание: Изменение данных своего продукта
- Пользовательский сценарий: Пользователь открывает свой продукт → редактирует → сохраняет
- Входные данные: ID продукта, обновленные данные
- Выходные данные: обновленный продукт
- Ограничения: можно редактировать только свои продукты

Функция 3.5: Удаление пользовательского продукта
- Описание: Удаление своего продукта
- Пользовательский сценарий: Пользователь открывает свой продукт → удаляет → подтверждает
- Входные данные: ID продукта
- Выходные данные: статус удаления
- Ограничения: можно удалять только свои продукты

Функция 3.6: Избранные продукты
- Описание: Добавление продуктов в избранное для быстрого доступа
- Пользовательский сценарий: Пользователь нажимает на звездочку у продукта → продукт добавляется/удаляется из избранного
- Входные данные: ID продукта
- Выходные данные: обновленный список избранного
- Ограничения: нет

Функция 3.7: Просмотр категорий продуктов
- Описание: Фильтрация продуктов по категориям
- Пользовательский сценарий: Пользователь выбирает категорию → видит продукты этой категории
- Входные данные: ID категории
- Выходные данные: список продуктов категории
- Ограничения: нет
```

**Модуль 4: Управление элементами приема пищи (блюдами)**

```
Функция 4.1: Добавление продукта в прием пищи
- Описание: Добавление продукта с указанием количества
- Пользовательский сценарий:
  1. Пользователь находит продукт (поиск/скан/избранное)
  2. Указывает количество в граммах
  3. Система пересчитывает КБЖУ для указанного количества
  4. Продукт добавлен в прием пищи
- Входные данные: продукт, количество, ID приема пищи
- Выходные данные: элемент приема пищи с рассчитанными КБЖУ
- Ограничения: количество > 0

Функция 4.2: Редактирование элемента приема пищи
- Описание: Изменение количества продукта в приеме пищи
- Пользовательский сценарий: Пользователь открывает элемент → изменяет количество → КБЖУ пересчитываются автоматически
- Входные данные: ID элемента, новое количество
- Выходные данные: обновленный элемент с пересчитанными КБЖУ
- Ограничения: количество > 0

Функция 4.3: Удаление элемента из приема пищи
- Описание: Удаление продукта из приема пищи
- Пользовательский сценарий: Пользователь открывает элемент → удаляет → подтверждает
- Входные данные: ID элемента
- Выходные данные: статус удаления
- Ограничения: нельзя удалять элементы чужих приемов пищи

Функция 4.4: Автоматический пересчет КБЖУ
- Описание: Пересчет КБЖУ при изменении количества
- Пользовательский сценарий: При изменении количества система автоматически пересчитывает все показатели
- Входные данные: базовые КБЖУ, новое количество
- Выходные данные: пересчитанные КБЖУ
- Ограничения: нет

Функция 4.5: Сохранение продукта в базу при добавлении
- Описание: Опция сохранить новый продукт в личную базу при создании элемента
- Пользовательский сценарий: При создании нового продукта пользователь может выбрать чекбокс "Добавить в базу продуктов"
- Входные данные: чекбокс, данные продукта
- Выходные данные: продукт сохранен в личную базу
- Ограничения: нет
```

**Модуль 5: Анализ блюд по фотографии (NEW)**

```
Функция 5.1: Фотографирование блюда
- Описание: Съемка фото блюда через камеру или выбор из галереи
- Пользовательский сценарий:
  1. Пользователь нажимает "Анализ по фото"
  2. Делает фото или выбирает из галереи
  3. Фото отправляется на анализ
- Входные данные: изображение блюда
- Выходные данные: фото для обработки
- Ограничения: требуется доступ к камере/галерее

Функция 5.2: Распознавание блюда с помощью OpenAI Vision
- Описание: Анализ состава блюда с помощью AI
- Пользовательский сценарий:
  1. Фото отправляется в OpenAI Vision API
  2. AI определяет компоненты блюда
  3. Система оценивает КБЖУ на основе распознанных ингредиентов
  4. Пользователь видит результаты анализа
- Входные данные: изображение
- Выходные данные: список распознанных ингредиентов, оценочные КБЖУ
- Ограничения: качество распознавания зависит от качества фото

Функция 5.3: Редактирование результатов распознавания
- Описание: Корректировка распознанных данных
- Пользовательский сценарий: Пользователь видит результаты → корректирует состав/количество → сохраняет
- Входные данные: распознанные данные, правки пользователя
- Выходные данные: скорректированный элемент приема пищи
- Ограничения: нет

Функция 5.4: Сохранение блюда с фото
- Описание: Сохранение распознанного блюда в прием пищи с фотографией
- Пользовательский сценарий: После анализа пользователь сохраняет блюдо → оно добавляется в прием пищи с прикрепленным фото
- Входные данные: данные о блюде, фото
- Выходные данные: элемент приема пищи с фото
- Ограничения: нет
```

**Модуль 6: Составные блюда (в разработке)**

```
Функция 6.1: Создание рецепта блюда
- Описание: Создание сложного блюда из нескольких ингредиентов
- Пользовательский сценарий:
  1. Пользователь создает новое блюдо
  2. Добавляет ингредиенты с указанием количества
  3. Указывает количество порций
  4. Система рассчитывает КБЖУ на 100г и на порцию
  5. Блюдо сохранено
- Входные данные: название, список ингредиентов с количеством, количество порций, категория
- Выходные данные: созданное блюдо с рассчитанными КБЖУ
- Ограничения: минимум один ингредиент
- Статус: В разработке (функционал частично реализован на бэкенде)

Функция 6.2: Редактирование рецепта
- Описание: Изменение состава блюда
- Статус: В разработке

Функция 6.3: Удаление рецепта
- Описание: Удаление своего блюда
- Статус: В разработке

Функция 6.4: Добавление блюда в прием пищи
- Описание: Использование сохраненного рецепта
- Статус: В разработке
```

**Модуль 7: Статистика и дашборд**

```
Функция 7.1: Дневная статистика КБЖУ
- Описание: Отображение суммарных показателей за день
- Пользовательский сценарий: Пользователь видит прогресс-бары с потребленными/рекомендуемыми КБЖУ за день
- Входные данные: дата
- Выходные данные: суммарные калории, белки, жиры, углеводы, % от дневной нормы
- Ограничения: нет

Функция 7.2: Расчет рекомендуемой калорийности
- Описание: Автоматический расчет на основе формул (Миффлина-Сан Жеора)
- Пользовательский сценарий: Система рассчитывает базовый обмен и корректирует на уровень активности и цель
- Входные данные: пол, возраст, вес, рост, уровень активности, цель
- Выходные данные: рекомендуемая дневная калорийность
- Ограничения: нет

Функция 7.3: Расчет ИМТ (Индекс Массы Тела)
- Описание: Вычисление и отображение ИМТ
- Пользовательский сценарий: В профиле пользователь видит свой ИМТ
- Входные данные: вес, рост
- Выходные данные: значение ИМТ
- Ограничения: нет
```

**Модуль 8: Настройки**

```
Функция 8.1: Изменение имени
- Описание: Редактирование имени пользователя
- Входные данные: новое имя
- Выходные данные: обновленный профиль

Функция 8.2: Изменение email
- Описание: Изменение адреса электронной почты
- Входные данные: новый email
- Выходные данные: обновленный профиль

Функция 8.3: Изменение пароля
- Описание: Смена пароля
- Входные данные: старый пароль, новый пароль
- Выходные данные: подтверждение смены

Функция 8.4: Удаление аккаунта
- Описание: Полное удаление профиля и всех данных
- Входные данные: подтверждение
- Выходные данные: удаленный аккаунт

Функция 8.5: Темная/Светлая тема
- Описание: Автоматическое переключение темы в зависимости от системных настроек
- Входные данные: системная тема устройства
- Выходные данные: соответствующая тема приложения
```

**Модуль 9: Уведомления (Firebase)**

```
Функция 9.1: Push-уведомления
- Описание: Отправка push-уведомлений пользователям
- Пользовательский сценарий: Пользователь получает напоминания о приемах пищи, достижениях
- Входные данные: device token, текст уведомления
- Выходные данные: доставленное уведомление
- Ограничения: требуется разрешение на уведомления

Функция 9.2: Регистрация устройства
- Описание: Сохранение device token для отправки уведомлений
- Пользовательский сценарий: При первом входе приложение регистрирует устройство
- Входные данные: device token, тип устройства (iOS/Android)
- Выходные данные: зарегистрированное устройство
- Ограничения: нет
```

### 3.2. Пользовательские роли и права

| Роль                          | Права                                                                                                         | Ограничения                                                            |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| Неавторизованный пользователь | Регистрация, вход                                                                                             | Нет доступа к функциям приложения                                      |
| Авторизованный пользователь   | Полный доступ ко всем функциям: создание приемов пищи, продуктов, просмотр статистики, редактирование профиля | Может редактировать/удалять только свои данные (продукты, приемы пищи) |

---

## 4. Пользовательские сценарии

### 4.1. Основные пользовательские потоки

**Сценарий 1: Регистрация и первый запуск**

```
Предусловия: Пользователь скачал приложение, открывает впервые
Основной поток:
1. Пользователь видит экран приветствия
2. Нажимает "Зарегистрироваться"
3. Выбирает пол (Мужской/Женский)
4. Выбирает цель (Набрать/Сбросить/Сохранить вес)
5. Вводит текущий вес
6. Вводит желаемый вес (если цель не "Сохранить")
7. Вводит рост
8. Вводит дату рождения
9. Выбирает уровень физической активности
10. Вводит email и пароль
11. Принимает условия использования
12. Нажимает "Завершить регистрацию"
13. Система создает профиль, рассчитывает рекомендуемую калорийность
14. Пользователь попадает на главный экран
Постусловия: Профиль создан, пользователь авторизован
Альтернативные потоки:
- Вариант A: Пользователь нажимает "Войти через Google" → авторизуется через Google → заполняет анкету → профиль создан
- Вариант B: Некорректный email/пароль → система показывает ошибку → пользователь исправляет
```

**Сценарий 2: Вход существующего пользователя**

```
Предусловия: Пользователь уже зарегистрирован
Основной поток:
1. Пользователь открывает приложение
2. Вводит email и пароль
3. Нажимает "Войти"
4. Система проверяет учетные данные
5. Пользователь авторизован, попадает на главный экран
Постусловия: Пользователь авторизован
Альтернативные потоки:
- Вариант A: Неверные учетные данные → система показывает ошибку
- Вариант B: Пользователь нажимает "Забыли пароль" → вводит email → получает новый пароль на почту
- Вариант C: Пользователь нажимает "Войти через Google" → авторизуется → попадает на главный экран
```

**Сценарий 3: Добавление приема пищи вручную**

```
Предусловия: Пользователь авторизован, находится на главном экране
Основной поток:
1. Пользователь видит главный экран с расписанием питания за текущий день
2. Нажимает "Добавить прием пищи"
3. Нажимает "Поиск" для поиска продуктов
4. Вводит название продукта в поиск (например, "гречка")
5. Система показывает список найденных продуктов
6. Пользователь выбирает нужный продукт
7. Указывает количество (например, 150 г)
8. Система автоматически пересчитывает КБЖУ для указанного количества
9. Пользователь видит пересчитанные значения
10. Выбирает тип приема пищи (Завтрак/Обед/Ужин/Перекус) и время
11. Нажимает "Сохранить"
12. Прием пищи добавлен, отображается на главном экране
13. Дневная статистика КБЖУ обновилась
Постусловия: Прием пищи создан и отображается, статистика обновлена
Альтернативные потоки:
- Вариант A: Продукт не найден → пользователь создает новый продукт → добавляет в прием пищи
- Вариант B: Пользователь хочет добавить несколько продуктов → повторяет шаги 3-9 для каждого → сохраняет
- Вариант C: Пользователь ставит галочку "Добавить в базу продуктов" → новый продукт сохраняется в личную базу
```

**Сценарий 4: Сканирование штрихкода**

```
Предусловия: Пользователь авторизован, хочет добавить продукт по штрихкоду
Основной поток:
1. Пользователь на экране поиска нажимает иконку сканера штрихкодов
2. Приложение запрашивает доступ к камере (первый раз)
3. Пользователь разрешает доступ
4. Открывается камера с рамкой для сканирования
5. Пользователь наводит камеру на штрихкод продукта
6. Система распознает штрихкод
7. Отправляет запрос в базы данных (Open Food Facts, EAN-DB, собственная БД)
8. Находит продукт с КБЖУ
9. Отображает карточку найденного продукта
10. Пользователь указывает количество
11. Добавляет в прием пищи
Постусловия: Продукт найден по штрихкоду и добавлен
Альтернативные потоки:
- Вариант A: Штрихкод не распознан → система показывает ошибку → пользователь сканирует повторно
- Вариант B: Продукт не найден ни в одной БД → система предлагает создать новый продукт с указанным штрихкодом
- Вариант C: Найдено несколько вариантов → система показывает список → пользователь выбирает нужный
```

**Сценарий 5: Анализ блюда по фотографии**

```
Предусловия: Пользователь авторизован, хочет добавить блюдо по фото
Основной поток:
1. Пользователь на экране поиска нажимает "Анализ по фото"
2. Выбирает "Сделать фото" или "Выбрать из галереи"
3. Делает фото блюда или выбирает существующее
4. Фото отправляется в OpenAI Vision API
5. Система показывает индикатор загрузки "Анализируем блюдо..."
6. OpenAI Vision распознает компоненты блюда (например: рис 100г, курица 150г, овощи 80г)
7. Система находит эти продукты в БД и рассчитывает общие КБЖУ
8. Пользователь видит результаты анализа с фото
9. Может откорректировать состав и количество
10. Указывает тип приема пищи и время
11. Нажимает "Сохранить"
12. Блюдо с фото добавлено в прием пищи
Постусловия: Блюдо распознано, добавлено с фотографией
Альтернативные потоки:
- Вариант A: Плохое качество фото → AI не может распознать → система предлагает сделать фото повторно
- Вариант B: AI распознал неточно → пользователь вручную корректирует состав
- Вариант C: Ошибка API → система предлагает добавить блюдо вручную
```

**Сценарий 6: Использование избранных продуктов**

```
Предусловия: Пользователь авторизован, у него есть избранные продукты
Основной поток:
1. Пользователь на экране поиска переходит на вкладку "Избранное"
2. Видит список своих избранных продуктов
3. Выбирает нужный продукт
4. Указывает количество
5. Добавляет в прием пищи
Постусловия: Продукт из избранного добавлен в прием пищи
Альтернативные потоки:
- Вариант A: Список избранного пуст → пользователь ищет продукт → добавляет в избранное → использует
```

**Сценарий 7: Создание пользовательского продукта**

```
Предусловия: Пользователь авторизован, не нашел нужный продукт
Основной поток:
1. Пользователь на экране поиска нажимает "Создать новый продукт"
2. Вводит название (например, "Домашние сырники")
3. Вводит КБЖУ на 100г:
   - Белки: 12
   - Жиры: 8
   - Углеводы: 25
   - Калории: 220 (или автоматический расчет)
4. Выбирает категорию (например, "Молочные продукты")
5. Опционально делает фото или выбирает из галереи
6. Нажимает на звездочку "Добавить в избранное"
7. Нажимает "Сохранить"
8. Продукт создан и доступен в личной базе
Постусловия: Пользовательский продукт создан
Альтернативные потоки:
- Вариант A: Пользователь не указал количество → система показывает ошибку
- Вариант B: Пользователь создает продукт прямо при добавлении в прием пищи → ставит галочку "Добавить в базу продуктов"
```

**Сценарий 8: Просмотр статистики за день**

```
Предусловия: Пользователь авторизован, есть добавленные приемы пищи
Основной поток:
1. Пользователь на главном экране видит дневную статистику:
   - Калории: 1450 / 1800 (80%)
   - Белки: 85 / 100 г
   - Жиры: 50 / 60 г
   - Углеводы: 180 / 200 г
2. Видит прогресс-бары для каждого показателя
3. Видит список всех приемов пищи за день
4. Может выбрать другую дату в календаре
Постусловия: Пользователь ознакомлен со статистикой
```

**Сценарий 9: Редактирование профиля**

```
Предусловия: Пользователь авторизован
Основной поток:
1. Пользователь переходит во вкладку "Профиль"
2. Видит текущие данные: вес, рост, возраст, цель, ИМТ, рекомендации
3. Нажимает "Редактировать"
4. Изменяет вес (например, похудел на 2 кг)
5. Изменяет уровень активности (начал больше тренироваться)
6. Нажимает "Сохранить"
7. Система пересчитывает рекомендуемую калорийность
8. Обновленные данные отображаются в профиле
Постусловия: Профиль обновлен, рекомендации пересчитаны
```

**Сценарий 10: Удаление приема пищи**

```
Предусловия: Пользователь авторизован, есть созданный прием пищи
Основной поток:
1. Пользователь на главном экране видит список приемов пищи
2. Открывает нужный прием пищи
3. Нажимает на иконку корзины
4. Система показывает подтверждение "Подтверждаете удаление?"
5. Пользователь нажимает "ОК"
6. Прием пищи удален
7. Дневная статистика обновлена
Постусловия: Прием пищи удален, статистика пересчитана
```

---

## 5. Технические требования

### 5.1. Архитектура системы

**Компоненты системы:**

- **Мобильное приложение (React Native / Expo)**: Клиентское приложение для iOS и Android, навигация, управление состоянием (MobX), работа с камерой

- **Backend API (Spring Boot)**: RESTful API, аутентификация (JWT), бизнес-логика, интеграция с внешними сервисами

- **База данных (PostgreSQL)**: Хранение всех данных пользователей, продуктов, приемов пищи

- **Сервис парсинга продуктов**: Интеграция с Open Food Facts, EAN-DB, Barcode-list.ru

- **Сервис анализа изображений**: Интеграция с OpenAI Vision API для распознавания блюд

- **Сервис уведомлений**: Firebase Cloud Messaging для push-уведомлений

- **Gateway API**: Единая точка входа (http://80.87.201.75:8079/gateway)

**Взаимодействие компонентов:**

```
Mobile App → API Gateway → my-food/auth/elastic-search Services → PostgreSQL/External APIs → Firebase
```

### 5.2. Технологический стек

**Frontend:** React Native 0.74.5, Expo SDK ~51.0, MobX 6.x, React Navigation, React Native Paper, Expo Camera/Barcode Scanner, Expo Notifications

**Backend:** Java 11, Spring Boot 2.6.7, Spring Data JPA, Swagger 3.0.0, OpenFeign, Lombok, MapStruct

**База данных:** PostgreSQL 12+, Hikari Connection Pool

**Инфраструктура:** Docker, Debian сервер, резервное копирование БД

**Внешние сервисы:** OpenAI Vision API, Firebase (Authentication, Cloud Messaging), Open Food Facts, EAN-DB, Barcode-list.ru

### 5.3. Модель данных

**Основные сущности:**

- **UserProfile**: id, user_id, height, weight, gender, birthday, target_weight_type, target_weight, physical_activity_level, day_limit_cal, created, modified

- **Product**: id, user_id, name, proteins, fats, carbohydrates, calories, quantity, measurement_type, code (barcode), image_url, source, product_category_id, store, price

- **ProductCategory**: id, name

- **Meal**: id, user_id, meal_type, name, date_time

- **MealElement**: id, meal*id, parent_product_id, name, proteins, fats, carbohydrates, calories, quantity, measurement_type, code, image_url, default*\* (базовые значения)

- **Dish** (в разработке): id, user_id, name, description, КБЖУ, status, portions, dish_category_id

- **DishIngredient**: id, dish_id, name, code, quantity, measurement_type, ingredient_type

- **Favorite**: id, user_id, product_id

- **Device**: id, user_id, device_token, device_type

---

## 6. Нефункциональные требования

### 6.1. Производительность

- Время отклика API: 95% запросов < 1 сек, 99% < 3 сек, анализ фото < 40 сек
- Пропускная способность: 1,000 → 100,000 пользователей
- Время загрузки: холодный старт < 3 сек, переходы < 300 мс
- Размер приложения: Android < 50 MB, iOS < 60 MB

### 6.2. Надежность

- Uptime: 99%
- RTO: 4 часа, RPO: 24 часа
- Ежедневное резервное копирование БД (хранение 7 дней)
- Graceful degradation при недоступности внешних API

### 6.3. Безопасность

- JWT токены для аутентификации
- OAuth 2.0 для Google Sign-In
- HTTPS для всех соединений
- Secure Storage для токенов на клиенте
- Хеширование паролей (BCrypt)
- Валидация всех входных данных
- Логирование критичных операций
- Политика конфиденциальности и GDPR (базовое соответствие)

### 6.4. Масштабируемость

- Вертикальное: увеличение ресурсов сервера, оптимизация БД
- Горизонтальное: stateless backend, load balancer (в будущем), read replicas
- Connection pooling, индексирование, pagination

### 6.5. Совместимость

- Android 5.0+ (API 21), iOS 13+
- Portrait ориентация
- Экраны от 4.7" до 6.7"+

---

## 7. Требования к интерфейсу

### 7.1. Пользовательский интерфейс

**Принципы UX:** Простота, минимализм, последовательность, быстрота (< 30 сек на добавление), обратная связь, темная/светлая тема

**Цвета:** Основной #43a047 (зеленый), серый #9599a4, фон светлый #f2f2f2, фон темный #222222

**Ключевые экраны:**

1. Регистрация/Вход (email, пароль, Google Sign-In)
2. Онбординг (пол, цель, вес, рост, дата рождения, активность)
3. Главный экран (дата, статистика КБЖУ, список приемов пищи)
4. Поиск продуктов (поиск, сканер, фото, избранное)
5. Добавление блюда (название, фото, КБЖУ, количество, тип приема пищи)
6. Профиль (данные, ИМТ, рекомендации)
7. Настройки (имя, email, пароль, удаление)
8. Сканер штрихкодов
9. Анализ по фото

**Навигация:** Bottom Tabs (Приемы пищи / База продуктов / Профиль), Stack для вложенных экранов

### 7.2. API-интерфейсы

**Base URL:** `http://80.87.201.75:8079/gateway`

**Основные эндпоинты:**

- `POST /auth/token` - вход
- `POST /auth/user` - регистрация
- `GET /auth/user` - данные пользователя
- `POST /my-food/user-profile` - создание профиля
- `GET /my-food/user-profile` - получение профиля
- `GET /my-food/product/search/name?name={name}` - поиск продуктов
- `GET /my-food/product/search/barcode/{barcode}` - поиск по штрихкоду
- `POST /my-food/product` - создание продукта
- `POST /my-food/meal` - создание приема пищи
- `GET /my-food/meal/findByDate?date={date}` - приемы пищи за дату
- `POST /my-food/meal_element` - создание элемента приема пищи
- `POST /my-food/favorite/{productId}` - добавить в избранное
- `GET /my-food/favorite` - получить избранное

**Swagger:** `http://80.87.201.75:8079/gateway/my-food/swagger-ui/`

---

## 8. Ограничения и допущения

### 8.1. Ограничения

- Использование бесплатных tier внешних сервисов
- OpenAI Vision API - платный, требуется контроль расходов
- Срок MVP: 1 месяц, команда 3 человека
- Expo Go не поддерживает все модули (требуется dev build)
- Одна БД на одном сервере
- Только русский язык интерфейса
- Нет оффлайн режима
- Составные блюда (Dishes) в разработке

### 8.2. Допущения

- Стабильное интернет-соединение у пользователей
- Сервер 80.87.201.75:8079 будет доступен
- PostgreSQL справится с нагрузкой до 100k пользователей
- OpenAI Vision качественно распознает блюда
- Базы штрихкодов актуальны

---

## 9. Риски

### 9.1. Технические риски

| Риск                                            | Вероятность | Влияние     | Меры mitigation                                              |
| ----------------------------------------------- | ----------- | ----------- | ------------------------------------------------------------ |
| Недоступность/высокие расходы OpenAI Vision API | Средняя     | Высокое     | Ограничение запросов, альтернативы, бета-тестирование        |
| Неточность распознавания AI                     | Высокая     | Среднее     | Ручная корректировка, обучение пользователей, обратная связь |
| Недостаточность данных штрихкодов               | Средняя     | Среднее     | Несколько источников, создание продуктов пользователями      |
| Проблемы производительности БД                  | Средняя     | Высокое     | Оптимизация, индексы, масштабирование, мониторинг            |
| Отказ сервера/БД                                | Низкая      | Критическое | Бэкапы, план восстановления, мониторинг                      |

### 9.2. Бизнес-риски

| Риск                  | Вероятность | Влияние | Меры mitigation                                 |
| --------------------- | ----------- | ------- | ----------------------------------------------- |
| Низкий retention      | Средняя     | Высокое | Улучшение UX, геймификация, уведомления         |
| Высокая конкуренция   | Высокая     | Высокое | Уникальные функции (AI фото, БД СНГ), маркетинг |
| Сложность монетизации | Средняя     | Среднее | Тестирование моделей (реклама, подписка)        |

---

## 10. План реализации

### 10.1. Этапы разработки

**Фаза 1: MVP — 1 месяц (20.10.2024 - 20.11.2024)**

**Backend:**

- ✅ Аутентификация (JWT, регистрация, вход, восстановление пароля)
- ✅ CRUD профиля, продуктов, приемов пищи, элементов
- ✅ Категории, избранное, поиск
- 🔨 Интеграция Open Food Facts (парсинг штрихкодов)
- 🔨 Рефакторинг кода
- ⏳ Google Sign-In
- ⏳ OpenAI Vision API

**Frontend:**

- ✅ Вход, регистрация, онбординг
- ✅ Главный экран, статистика, поиск, профиль
- ✅ Создание/редактирование элементов, избранное
- ✅ Темная/светлая тема
- 🔨 Улучшение сканера штрихкодов
- ⏳ Анализ фото
- ⏳ Google Sign-In
- ⏳ Push-уведомления

**Приоритеты:** P0 - стабилизация, P1 - Open Food Facts, P2 - AI фото, Google, P3 - уведомления

**Критерии MVP:**

- Все основные функции работают
- Пользователь может зарегистрироваться, создать профиль, добавлять продукты (вручную/поиск/штрихкод), создавать приемы пищи, видеть статистику
- Приложение собирается на Android/iOS
- Backend покрыт тестами (критичные части)
- Время добавления приема пищи < 30 сек

**Фаза 2: Улучшения — 2 месяца (21.11.2024 - 20.01.2025)**

- Составные блюда (полная реализация)
- Улучшение AI распознавания
- Статистика и аналитика
- Рецепты и планирование
- Экспорт/импорт
- CI/CD

**Фаза 3: Масштабирование — 3+ месяца (с 21.01.2025)**

- Монетизация (реклама/подписка)
- Премиум функции
- Фитнес-трекеры
- Социальные функции
- Мультиязычность
- Масштабирование инфраструктуры

### 10.2. Критерии приемки MVP

- Пользователь может зарегистрироваться/войти, заполнить профиль, получить рекомендации
- Пользователь может найти продукт (поиск/скан), создать прием пищи, видеть статистику
- Время на добавление < 30 сек
- Работает на Android 5.0+, iOS 13+
- API отвечает < 3 сек на 95% запросов
- Поддержка темной/светлой темы
- JWT, HTTPS, хеширование паролей
- Backend unit-тесты (критичные части)

---

## 11. Документация

### 11.1. Техническая документация

- ✅ Swagger/OpenAPI для Backend API
- ⏳ Архитектурная документация (диаграммы, схема БД)
- ⏳ README (backend, frontend)
- ⏳ Руководство по развертыванию

### 11.2. Пользовательская документация

- ⏳ FAQ
- ⏳ Политика конфиденциальности
- ⏳ Пользовательское соглашение

---

## 12. Глоссарий

| Термин              | Определение                               |
| ------------------- | ----------------------------------------- |
| КБЖУ                | Калории, Белки, Жиры, Углеводы            |
| JWT                 | JSON Web Token                            |
| MVP                 | Minimum Viable Product                    |
| ИМТ                 | Индекс Массы Тела                         |
| API                 | Application Programming Interface         |
| Прием пищи          | Завтрак, обед, ужин с временем и составом |
| Элемент приема пищи | Отдельное блюдо/продукт в приеме пищи     |
| Штрихкод            | Barcode - уникальный код товара           |
| EAN-13              | European Article Number (13 цифр)         |
| Firebase            | Платформа Google для разработки           |
| Expo                | Фреймворк для React Native                |
| MobX                | Управление состоянием (state management)  |
| OTA                 | Over-The-Air обновление                   |
| Fallback            | Резервный вариант                         |
| Onboarding          | Знакомство нового пользователя            |
| Retention           | Удержание пользователей                   |
| CRUD                | Create, Read, Update, Delete              |

---

## 13. Приложения

### 13.1. Конкурентный анализ

| Приложение      | Сильные стороны                           | Слабые стороны                             | Отличие MealRush                     |
| --------------- | ----------------------------------------- | ------------------------------------------ | ------------------------------------ |
| MyFitnessPal    | 14+ млн продуктов, сканер, фитнес-трекеры | Сложный UI, много рекламы, неполная БД СНГ | Русский интерфейс, AI фото, простота |
| FatSecret       | Бесплатный, сканер, сообщество            | Устаревший дизайн, медленно                | Современный UI, быстрота, AI         |
| Lifesum         | Красивый дизайн, персонализация           | Платная подписка, нет фокуса на СНГ        | Бесплатный базовый функционал        |
| YAZIO           | Удобный UI, русский язык                  | Многие функции платные                     | AI фото, полная бесплатная версия    |
| Дневник питания | Русский, БД СНГ, бесплатный               | Устаревший, нет AI/сканера                 | Современный стек, AI функции         |

**Уникальность MealRush:**

1. AI анализ блюд по фото (OpenAI Vision)
2. Качественная интеграция с БД СНГ
3. Быстрый интерфейс (< 30 сек)
4. Современный стек
5. Фокус на СНГ

### 13.2. Источники данных о продуктах

1. **Open Food Facts** - бесплатный, международная база, API (основной)
2. **EAN-DB** - 67+ млн товаров, 250 бесплатных запросов (дополнительный)
3. **Barcode-list.ru** - российская база, 5+ млн штрихкодов (СНГ)
4. **GS1** - официальный источник (опциональный)

**Стратегия:** Open Food Facts → EAN-DB → Barcode-list.ru → собственная БД, кеширование

### 13.3. Диаграммы

**Архитектура:**

```
Mobile App (React Native/Expo)
    ↓ HTTPS (JWT)
API Gateway (80.87.201.75:8079/gateway)
    ↓
my-food/auth/elastic-search Services
    ↓
PostgreSQL + External APIs (Open Food Facts, EAN-DB, Barcode-list, OpenAI Vision)
    +
Firebase Cloud Messaging
```

**Основные потоки:**

- Добавление вручную: Главный экран → Поиск → Выбор → Количество → Сохранение
- Сканирование: Поиск → Сканер → Распознавание → API → Продукт → Добавление
- AI фото: Поиск → Фото → OpenAI Vision → Распознавание → Корректировка → Сохранение

### 13.4. Референсы

- Backend: `/my-food` (Spring Boot)
- Frontend: `/FoodApp` (React Native/Expo)
- Swagger: http://80.87.201.75:8079/gateway/my-food/swagger-ui/
- Open Food Facts: https://world.openfoodfacts.org/
- OpenAI Vision: https://platform.openai.com/docs/guides/vision
- Firebase: https://firebase.google.com/docs
- Expo: https://docs.expo.dev/

---

## Заключение

Данное техническое задание определяет требования, архитектуру и план реализации MealRush 2.0.0. Документ будет обновляться по мере развития проекта.

**Следующие шаги:**

1. Утверждение ТЗ
2. Приоритизация задач MVP
3. Создание задач в трекере
4. Начало разработки
5. Регулярные встречи команды
6. Итеративная разработка

**Контакты:**

- Product Owner / Tech Lead: L423r
- Frontend Developer: Knois
- QA: ir1sha

**Дата утверждения:** 20 октября 2024  
**Версия документа:** 1.0
